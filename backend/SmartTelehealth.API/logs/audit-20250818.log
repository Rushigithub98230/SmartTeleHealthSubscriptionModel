2025-08-18 15:39:53.569 +05:30 [WRN] The foreign key property 'QuestionnaireTemplate.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 15:39:53.620 +05:30 [WRN] The foreign key property 'UserResponse.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 15:39:53.692 +05:30 [WRN] No store type was specified for the decimal property 'Amount' on entity type 'Subscription'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-08-18 15:39:55.416 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-08-18 15:39:55.877 +05:30 [INF] Subscription Background Service started
2025-08-18 15:39:56.185 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:39:56.186 +05:30 [INF] Starting automated billing process
2025-08-18 15:39:56.189 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 15:39:56.294 +05:30 [INF] Automated billing service started
2025-08-18 15:39:56.324 +05:30 [ERR] Failed executing DbCommand (27ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:39:56.346 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:39:56.380 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:56.578 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:39:56.595 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:39:56.595 +05:30 [ERR] Error in recurring billing process by user 0
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:56.702 +05:30 [ERR] Error in automated billing process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessAutomatedBillingAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 74
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:56.710 +05:30 [INF] Starting lifecycle management process
2025-08-18 15:39:56.738 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:09:56.7380798Z"
2025-08-18 15:39:56.753 +05:30 [ERR] Failed executing DbCommand (8ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:39:56.755 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:56.835 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:56.909 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:57.012 +05:30 [ERR] Failed executing DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate], [m].[Id], [m].[CreatedBy], [m].[CreatedDate], [m].[DeletedBy], [m].[DeletedDate], [m].[Description], [m].[DurationInDays], [m].[IsActive], [m].[IsDeleted], [m].[Name], [m].[SortOrder], [m].[UpdatedBy], [m].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
INNER JOIN [MasterBillingCycles] AS [m] ON [s].[BillingCycleId] = [m].[Id]
WHERE [s].[IsDeleted] = CAST(0 AS bit)
ORDER BY [s].[CreatedAt] DESC
2025-08-18 15:39:57.010 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:57.014 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:57.121 +05:30 [ERR] Error in lifecycle management process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetAllSubscriptionsAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 228
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessLifecycleManagementAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 95
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:39:58.283 +05:30 [WRN] Failed to determine the https port for redirect.
2025-08-18 15:44:57.036 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:44:57.036 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:44:57.037 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:44:57.047 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:14:57.0475964Z"
2025-08-18 15:44:57.061 +05:30 [ERR] Failed executing DbCommand (13ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:44:57.063 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:44:57.169 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:44:57.235 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:44:57.307 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:c48c904d-7775-4668-a19a-76533d8ec5a3
Error Number:207,State:1,Class:16
2025-08-18 15:44:57.606 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:44:57.607 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:44:57.607 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:49:57.327 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:49:57.327 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:49:57.328 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:49:57.330 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:19:57.3301465Z"
2025-08-18 15:49:57.424 +05:30 [ERR] Failed executing DbCommand (9ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:49:57.425 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:49:57.494 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:49:57.562 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:49:57.640 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:54:57.692 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:54:57.706 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:54:57.706 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:54:57.763 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:24:57.7631803Z"
2025-08-18 15:54:57.869 +05:30 [ERR] Failed executing DbCommand (62ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:54:57.887 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:54:58.009 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:54:58.144 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:54:58.285 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:59:58.309 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 15:59:58.309 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 15:59:58.309 +05:30 [INF] Stripe service initialized successfully
2025-08-18 15:59:58.320 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:29:58.3188344Z"
2025-08-18 15:59:58.361 +05:30 [ERR] Failed executing DbCommand (17ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 15:59:58.365 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:59:58.456 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:59:58.566 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 15:59:58.681 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:1186f626-133f-4f49-aed4-ceb95d97f981
Error Number:207,State:1,Class:16
2025-08-18 16:04:58.697 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:04:58.698 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:04:58.698 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:04:58.715 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:34:58.7151521Z"
2025-08-18 16:04:59.013 +05:30 [ERR] Failed executing DbCommand (12ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:04:59.016 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:04:59.112 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:04:59.187 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:04:59.280 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:09:59.305 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:09:59.306 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:09:59.307 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:09:59.362 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:39:59.3612867Z"
2025-08-18 16:09:59.408 +05:30 [ERR] Failed executing DbCommand (35ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:09:59.411 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:09:59.484 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:09:59.566 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:09:59.650 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:7b103cab-4209-4363-b031-fe14ae0d0a85
Error Number:207,State:1,Class:16
2025-08-18 16:14:59.672 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:14:59.672 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:14:59.672 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:14:59.676 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:44:59.6766489Z"
2025-08-18 16:14:59.831 +05:30 [ERR] Failed executing DbCommand (15ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:14:59.832 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:14:59.895 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:14:59.963 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:15:00.040 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:20:00.052 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:20:00.052 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:20:00.053 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:20:00.056 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:50:00.0568772Z"
2025-08-18 16:20:00.067 +05:30 [ERR] Failed executing DbCommand (7ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:20:00.069 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:20:00.130 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:20:00.194 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:20:00.261 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:a9eb993a-d5b1-4d30-98d3-cb9e86312cdc
Error Number:207,State:1,Class:16
2025-08-18 16:25:00.280 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:25:00.282 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:25:00.282 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:25:00.285 +05:30 [INF] Starting automated billing cycle at "2025-08-18T10:55:00.2853878Z"
2025-08-18 16:25:00.370 +05:30 [ERR] Failed executing DbCommand (10ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:25:00.371 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:62cc2741-5e8d-4412-9794-22d4eed0b920
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:62cc2741-5e8d-4412-9794-22d4eed0b920
Error Number:207,State:1,Class:16
2025-08-18 16:25:00.433 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:62cc2741-5e8d-4412-9794-22d4eed0b920
Error Number:207,State:1,Class:16
2025-08-18 16:25:00.499 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:62cc2741-5e8d-4412-9794-22d4eed0b920
Error Number:207,State:1,Class:16
2025-08-18 16:25:00.568 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:62cc2741-5e8d-4412-9794-22d4eed0b920
Error Number:207,State:1,Class:16
2025-08-18 16:30:00.573 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:30:00.573 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:30:00.573 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:30:00.574 +05:30 [INF] Starting automated billing cycle at "2025-08-18T11:00:00.5749012Z"
2025-08-18 16:30:00.674 +05:30 [ERR] Failed executing DbCommand (11ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:30:00.676 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:9dace899-9529-45b7-be3c-8b2da6dd72ea
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:9dace899-9529-45b7-be3c-8b2da6dd72ea
Error Number:207,State:1,Class:16
2025-08-18 16:30:00.743 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:9dace899-9529-45b7-be3c-8b2da6dd72ea
Error Number:207,State:1,Class:16
2025-08-18 16:30:00.814 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:9dace899-9529-45b7-be3c-8b2da6dd72ea
Error Number:207,State:1,Class:16
2025-08-18 16:30:00.884 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:9dace899-9529-45b7-be3c-8b2da6dd72ea
Error Number:207,State:1,Class:16
2025-08-18 16:34:48.687 +05:30 [WRN] The foreign key property 'QuestionnaireTemplate.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 16:34:48.744 +05:30 [WRN] The foreign key property 'UserResponse.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 16:34:48.837 +05:30 [WRN] No store type was specified for the decimal property 'Amount' on entity type 'Subscription'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-08-18 16:34:50.389 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-08-18 16:34:50.882 +05:30 [INF] Subscription Background Service started
2025-08-18 16:34:51.274 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:34:51.275 +05:30 [INF] Starting automated billing process
2025-08-18 16:34:51.277 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 16:34:51.361 +05:30 [INF] Automated billing service started
2025-08-18 16:34:51.389 +05:30 [ERR] Failed executing DbCommand (26ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:34:51.414 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:34:51.451 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.560 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:34:51.578 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:34:51.577 +05:30 [ERR] Error in recurring billing process by user 0
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.667 +05:30 [ERR] Error in automated billing process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessAutomatedBillingAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 74
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.675 +05:30 [INF] Starting lifecycle management process
2025-08-18 16:34:51.706 +05:30 [INF] Starting automated billing cycle at "2025-08-18T11:04:51.7064912Z"
2025-08-18 16:34:51.725 +05:30 [ERR] Failed executing DbCommand (15ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:34:51.727 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.793 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.894 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:51.976 +05:30 [ERR] Failed executing DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate], [m].[Id], [m].[CreatedBy], [m].[CreatedDate], [m].[DeletedBy], [m].[DeletedDate], [m].[Description], [m].[DurationInDays], [m].[IsActive], [m].[IsDeleted], [m].[Name], [m].[SortOrder], [m].[UpdatedBy], [m].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
INNER JOIN [MasterBillingCycles] AS [m] ON [s].[BillingCycleId] = [m].[Id]
WHERE [s].[IsDeleted] = CAST(0 AS bit)
ORDER BY [s].[CreatedAt] DESC
2025-08-18 16:34:52.019 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:52.018 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:52.106 +05:30 [ERR] Error in lifecycle management process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetAllSubscriptionsAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 228
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessLifecycleManagementAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 95
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:34:52.676 +05:30 [WRN] Failed to determine the https port for redirect.
2025-08-18 16:35:36.266 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:35:36.268 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:35:36.268 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:39:52.118 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:39:52.119 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:39:52.159 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:39:52.175 +05:30 [INF] Starting automated billing cycle at "2025-08-18T11:09:52.1757506Z"
2025-08-18 16:39:52.193 +05:30 [ERR] Failed executing DbCommand (16ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:39:52.195 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:39:52.292 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:39:52.400 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:39:52.494 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:38566dcb-2622-412f-abce-6beeeabb3e3e
Error Number:207,State:1,Class:16
2025-08-18 16:40:10.007 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:40:10.007 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:40:10.008 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:44:35.555 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:44:35.555 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:44:35.555 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:44:52.513 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:44:52.513 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:44:52.514 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:44:52.514 +05:30 [INF] Starting automated billing cycle at "2025-08-18T11:14:52.5147987Z"
2025-08-18 16:44:52.522 +05:30 [ERR] Failed executing DbCommand (7ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:44:52.523 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:44:52.587 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:44:52.651 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:44:52.720 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:49:52.743 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 16:49:52.743 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 16:49:52.743 +05:30 [INF] Stripe service initialized successfully
2025-08-18 16:49:52.748 +05:30 [INF] Starting automated billing cycle at "2025-08-18T11:19:52.7479722Z"
2025-08-18 16:49:52.759 +05:30 [ERR] Failed executing DbCommand (5ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 16:49:52.761 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:49:52.835 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:49:52.903 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 16:49:52.975 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:533addc4-d2e0-487e-b163-fed876d1dad3
Error Number:207,State:1,Class:16
2025-08-18 18:53:06.435 +05:30 [WRN] The foreign key property 'QuestionnaireTemplate.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 18:53:06.493 +05:30 [WRN] The foreign key property 'UserResponse.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 18:53:06.566 +05:30 [WRN] No store type was specified for the decimal property 'Amount' on entity type 'Subscription'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-08-18 18:53:07.734 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-08-18 18:53:08.188 +05:30 [INF] Subscription Background Service started
2025-08-18 18:53:08.385 +05:30 [INF] Stripe service initialized successfully
2025-08-18 18:53:08.387 +05:30 [INF] Starting automated billing process
2025-08-18 18:53:08.390 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 18:53:08.457 +05:30 [INF] Automated billing service started
2025-08-18 18:53:08.472 +05:30 [ERR] Failed executing DbCommand (12ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 18:53:08.499 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 18:53:08.508 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.523 +05:30 [ERR] Error in recurring billing process by user 0
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.525 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 18:53:08.547 +05:30 [ERR] Error in automated billing process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Application.Services.AutomatedBillingService.ProcessRecurringBillingAsync(TokenModel tokenModel) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\AutomatedBillingService.cs:line 38
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessAutomatedBillingAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 74
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.547 +05:30 [INF] Stripe service initialized successfully
2025-08-18 18:53:08.562 +05:30 [INF] Starting lifecycle management process
2025-08-18 18:53:08.607 +05:30 [INF] Starting automated billing cycle at "2025-08-18T13:23:08.6075280Z"
2025-08-18 18:53:08.618 +05:30 [ERR] Failed executing DbCommand (6ms) [Parameters=[@__billingDate_0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
WHERE [s].[Status] = N'Active' AND [s].[NextBillingDate] <= @__billingDate_0 AND [s].[IsDeleted] = CAST(0 AS bit)
2025-08-18 18:53:08.623 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.636 +05:30 [ERR] Error processing due subscriptions
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.643 +05:30 [ERR] Failed executing DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [s].[Id], [s].[Amount], [s].[AutoRenew], [s].[BillingCycleId], [s].[CancellationReason], [s].[CancelledAt], [s].[CancelledDate], [s].[CreatedAt], [s].[CreatedBy], [s].[CreatedDate], [s].[Currency], [s].[CurrentPrice], [s].[DeletedBy], [s].[DeletedDate], [s].[EndDate], [s].[ExpirationDate], [s].[ExpiredAt], [s].[ExpiryDate], [s].[FailedPaymentAttempts], [s].[HealthAssessmentId], [s].[IsActive], [s].[IsDeleted], [s].[IsTrialSubscription], [s].[LastBillingDate], [s].[LastPaymentDate], [s].[LastPaymentError], [s].[LastPaymentFailedDate], [s].[LastUsedDate], [s].[MasterBillingCycleId], [s].[MasterCurrencyId], [s].[NextBillingDate], [s].[Notes], [s].[PauseReason], [s].[PausedDate], [s].[PaymentMethodId], [s].[ProviderId], [s].[RenewedAt], [s].[ResumedDate], [s].[StartDate], [s].[Status], [s].[StatusReason], [s].[StripeCustomerId], [s].[StripeSubscriptionId], [s].[SubscriptionPlanId], [s].[SubscriptionStatus], [s].[SuspendedDate], [s].[TotalUsageCount], [s].[TrialDurationInDays], [s].[TrialEndDate], [s].[TrialStartDate], [s].[UpdatedAt], [s].[UpdatedBy], [s].[UpdatedDate], [s].[UserId], [u].[Id], [u].[AccessFailedCount], [u].[Address], [u].[City], [u].[ConcurrencyStamp], [u].[Country], [u].[CreatedAt], [u].[CreatedBy], [u].[CreatedDate], [u].[DateOfBirth], [u].[DeletedBy], [u].[DeletedDate], [u].[Email], [u].[EmailConfirmed], [u].[EmergencyContact], [u].[EmergencyContactName], [u].[EmergencyContactPhone], [u].[EmergencyPhone], [u].[FirstName], [u].[Gender], [u].[IsActive], [u].[IsDeleted], [u].[IsEmailVerified], [u].[IsPhoneVerified], [u].[LanguagePreference], [u].[LastLoginAt], [u].[LastName], [u].[LicenseNumber], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[NotificationPreferences], [u].[PasswordHash], [u].[PasswordResetToken], [u].[Phone], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[ProfilePicture], [u].[RefreshToken], [u].[RefreshTokenExpiry], [u].[ResetTokenExpires], [u].[SecurityStamp], [u].[State], [u].[StripeCustomerId], [u].[TimeZonePreference], [u].[TwoFactorEnabled], [u].[UpdatedAt], [u].[UpdatedBy], [u].[UpdatedDate], [u].[UserName], [u].[UserRoleId], [u].[UserType], [u].[ZipCode], [s0].[Id], [s0].[BillingCycleId], [s0].[CategoryId], [s0].[CreatedAt], [s0].[CreatedBy], [s0].[CreatedDate], [s0].[CurrencyId], [s0].[DeletedBy], [s0].[DeletedDate], [s0].[Description], [s0].[DiscountValidUntil], [s0].[DiscountedPrice], [s0].[DisplayOrder], [s0].[EffectiveDate], [s0].[ExpirationDate], [s0].[Features], [s0].[IsActive], [s0].[IsDeleted], [s0].[IsFeatured], [s0].[IsMostPopular], [s0].[IsTrending], [s0].[IsTrialAllowed], [s0].[MasterBillingCycleId], [s0].[MasterCurrencyId], [s0].[Name], [s0].[Price], [s0].[ShortDescription], [s0].[StripeAnnualPriceId], [s0].[StripeMonthlyPriceId], [s0].[StripeProductId], [s0].[StripeQuarterlyPriceId], [s0].[Terms], [s0].[TrialDurationInDays], [s0].[UpdatedAt], [s0].[UpdatedBy], [s0].[UpdatedDate], [m].[Id], [m].[CreatedBy], [m].[CreatedDate], [m].[DeletedBy], [m].[DeletedDate], [m].[Description], [m].[DurationInDays], [m].[IsActive], [m].[IsDeleted], [m].[Name], [m].[SortOrder], [m].[UpdatedBy], [m].[UpdatedDate]
FROM [Subscriptions] AS [s]
INNER JOIN [Users] AS [u] ON [s].[UserId] = [u].[Id]
INNER JOIN [SubscriptionPlans] AS [s0] ON [s].[SubscriptionPlanId] = [s0].[Id]
INNER JOIN [MasterBillingCycles] AS [m] ON [s].[BillingCycleId] = [m].[Id]
WHERE [s].[IsDeleted] = CAST(0 AS bit)
ORDER BY [s].[CreatedAt] DESC
2025-08-18 18:53:08.650 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.655 +05:30 [ERR] An exception occurred while iterating over the results of a query for context type 'SmartTelehealth.Infrastructure.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.667 +05:30 [ERR] Error in automated billing cycle
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetSubscriptionsDueForBillingAsync(DateTime billingDate) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 123
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessDueSubscriptionsAsync(ISubscriptionRepository subscriptionRepository, IBillingService billingService, INotificationService notificationService, IAuditService auditService, IUserService userService) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 99
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ProcessBillingCycleAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 66
   at SmartTelehealth.Infrastructure.Services.AutomatedBillingService.ExecuteAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Services\AutomatedBillingService.cs:line 36
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:08.674 +05:30 [ERR] Error in lifecycle management process
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Amount'.
Invalid column name 'CancelledAt'.
Invalid column name 'Currency'.
Invalid column name 'ExpiredAt'.
Invalid column name 'ExpiryDate'.
Invalid column name 'RenewedAt'.
Invalid column name 'SubscriptionStatus'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at SmartTelehealth.Infrastructure.Repositories.SubscriptionRepository.GetAllSubscriptionsAsync() in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Infrastructure\Repositories\SubscriptionRepository.cs:line 228
   at SmartTelehealth.Application.Services.BackgroundServices.SubscriptionBackgroundService.ProcessLifecycleManagementAsync(CancellationToken stoppingToken) in D:\DayUsers\Rushikesh\Personal\.Net Projects\TeleHealthWithSubscriptionModel-v1\backend\SmartTelehealth.Application\Services\BackgroundServices\SubscriptionBackgroundService.cs:line 95
ClientConnectionId:ed796f3a-a82e-43bc-ba7c-51a48ff4ad67
Error Number:207,State:1,Class:16
2025-08-18 18:53:22.424 +05:30 [INF] Subscription Background Service cancelled
2025-08-18 18:53:22.426 +05:30 [INF] Subscription Background Service stopped
2025-08-18 18:54:47.584 +05:30 [WRN] The foreign key property 'QuestionnaireTemplate.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 18:54:47.634 +05:30 [WRN] The foreign key property 'UserResponse.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 18:54:47.707 +05:30 [WRN] No store type was specified for the decimal property 'Amount' on entity type 'Subscription'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-08-18 18:54:48.632 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-08-18 18:54:48.962 +05:30 [INF] Subscription Background Service started
2025-08-18 18:54:49.116 +05:30 [INF] Stripe service initialized successfully
2025-08-18 18:54:49.118 +05:30 [INF] Starting automated billing process
2025-08-18 18:54:49.122 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 18:54:49.205 +05:30 [INF] Automated billing service started
2025-08-18 18:54:49.215 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 18:54:49.221 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 18:54:49.224 +05:30 [INF] Automated billing completed
2025-08-18 18:54:49.225 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 18:54:49.227 +05:30 [INF] Stripe service initialized successfully
2025-08-18 18:54:49.227 +05:30 [INF] Starting lifecycle management process
2025-08-18 18:54:49.272 +05:30 [INF] Starting automated billing cycle at "2025-08-18T13:24:49.2722293Z"
2025-08-18 18:54:49.277 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 18:54:49.304 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 18:54:49.336 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 18:54:49.339 +05:30 [INF] Completed automated billing cycle at "2025-08-18T13:24:49.3394483Z"
2025-08-18 18:54:49.345 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
2025-08-18 18:59:07.099 +05:30 [INF] Automated billing service stopped
2025-08-18 18:59:07.101 +05:30 [INF] Subscription Background Service cancelled
2025-08-18 18:59:07.102 +05:30 [INF] Subscription Background Service stopped
2025-08-18 19:13:33.348 +05:30 [WRN] The foreign key property 'QuestionnaireTemplate.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 19:13:33.380 +05:30 [WRN] The foreign key property 'UserResponse.CategoryId1' was created in shadow state because a conflicting property with the simple name 'CategoryId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-18 19:13:33.446 +05:30 [WRN] No store type was specified for the decimal property 'Amount' on entity type 'Subscription'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-08-18 19:13:34.569 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-08-18 19:13:34.949 +05:30 [INF] Subscription Background Service started
2025-08-18 19:13:35.167 +05:30 [INF] Stripe service initialized successfully
2025-08-18 19:13:35.167 +05:30 [INF] Starting automated billing process
2025-08-18 19:13:35.169 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 19:13:35.234 +05:30 [INF] Automated billing service started
2025-08-18 19:13:35.246 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 19:13:35.246 +05:30 [INF] Automated billing completed
2025-08-18 19:13:35.248 +05:30 [INF] Starting lifecycle management process
2025-08-18 19:13:35.286 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 19:13:35.330 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 19:13:35.331 +05:30 [INF] Stripe service initialized successfully
2025-08-18 19:13:35.340 +05:30 [INF] Starting automated billing cycle at "2025-08-18T13:43:35.3402864Z"
2025-08-18 19:13:35.344 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 19:13:35.376 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
2025-08-18 19:13:35.384 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 19:13:35.400 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 19:13:35.400 +05:30 [INF] Completed automated billing cycle at "2025-08-18T13:43:35.4005766Z"
2025-08-18 19:13:35.702 +05:30 [WRN] Failed to determine the https port for redirect.
2025-08-18 20:13:35.409 +05:30 [INF] Stripe service initialized successfully
2025-08-18 20:13:35.410 +05:30 [INF] Starting automated billing process
2025-08-18 20:13:35.410 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 20:13:35.412 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 20:13:35.412 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 20:13:35.419 +05:30 [INF] Stripe service initialized successfully
2025-08-18 20:13:35.429 +05:30 [INF] Starting automated billing cycle at "2025-08-18T14:43:35.4299057Z"
2025-08-18 20:13:35.519 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 20:13:35.521 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 20:13:35.521 +05:30 [INF] Automated billing completed
2025-08-18 20:13:35.522 +05:30 [INF] Starting lifecycle management process
2025-08-18 20:13:35.522 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 20:13:35.524 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 20:13:35.524 +05:30 [INF] Completed automated billing cycle at "2025-08-18T14:43:35.5248009Z"
2025-08-18 20:13:35.534 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
2025-08-18 21:13:35.555 +05:30 [INF] Stripe service initialized successfully
2025-08-18 21:13:35.556 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 21:13:35.556 +05:30 [INF] Starting automated billing process
2025-08-18 21:13:35.556 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 21:13:35.556 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 21:13:35.557 +05:30 [INF] Stripe service initialized successfully
2025-08-18 21:13:35.575 +05:30 [INF] Starting automated billing cycle at "2025-08-18T15:43:35.5757535Z"
2025-08-18 21:13:35.646 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 21:13:35.646 +05:30 [INF] Automated billing completed
2025-08-18 21:13:35.647 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 21:13:35.648 +05:30 [INF] Starting lifecycle management process
2025-08-18 21:13:35.650 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 21:13:35.651 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 21:13:35.651 +05:30 [INF] Completed automated billing cycle at "2025-08-18T15:43:35.6514595Z"
2025-08-18 21:13:35.658 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
2025-08-18 22:13:35.668 +05:30 [INF] Stripe service initialized successfully
2025-08-18 22:13:35.671 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 22:13:35.672 +05:30 [INF] Starting automated billing process
2025-08-18 22:13:35.672 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 22:13:35.672 +05:30 [INF] Stripe service initialized successfully
2025-08-18 22:13:35.672 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 22:13:35.675 +05:30 [INF] Starting automated billing cycle at "2025-08-18T16:43:35.6749958Z"
2025-08-18 22:13:35.773 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 22:13:35.773 +05:30 [INF] Automated billing completed
2025-08-18 22:13:35.774 +05:30 [INF] Starting lifecycle management process
2025-08-18 22:13:35.774 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 22:13:35.777 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 22:13:35.778 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 22:13:35.778 +05:30 [INF] Completed automated billing cycle at "2025-08-18T16:43:35.7786249Z"
2025-08-18 22:13:35.785 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
2025-08-18 23:13:35.799 +05:30 [INF] Twilio SMS client initialized successfully
2025-08-18 23:13:35.799 +05:30 [INF] Stripe service initialized successfully
2025-08-18 23:13:35.799 +05:30 [INF] SendGrid email client initialized successfully
2025-08-18 23:13:35.800 +05:30 [INF] Starting automated billing process
2025-08-18 23:13:35.800 +05:30 [INF] Stripe service initialized successfully
2025-08-18 23:13:35.800 +05:30 [INF] Starting recurring billing process by user 0
2025-08-18 23:13:35.803 +05:30 [INF] Starting automated billing cycle at "2025-08-18T17:43:35.8037801Z"
2025-08-18 23:13:35.900 +05:30 [INF] Found 0 subscriptions due for billing
2025-08-18 23:13:35.900 +05:30 [INF] Completed recurring billing process by user 0
2025-08-18 23:13:35.900 +05:30 [INF] Automated billing completed
2025-08-18 23:13:35.901 +05:30 [INF] Starting lifecycle management process
2025-08-18 23:13:35.904 +05:30 [INF] Found 0 suspended subscriptions
2025-08-18 23:13:35.907 +05:30 [INF] Found 0 subscriptions with usage counters to reset
2025-08-18 23:13:35.907 +05:30 [INF] Completed automated billing cycle at "2025-08-18T17:43:35.9078059Z"
2025-08-18 23:13:35.915 +05:30 [INF] Lifecycle management completed. Expired: 0, Trial Expired: 0
